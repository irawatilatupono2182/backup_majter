<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üì¶ Master Barang/Stock - Adam Jaya</title>
    <link rel="stylesheet" href="../../assets/css/filament-style.css">
    <style>
        .tab-button {
            padding: 0.75rem 1.25rem;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-600);
            transition: all 0.2s;
            margin-bottom: -2px;
        }
        .tab-button:hover {
            color: var(--primary-600);
            background: var(--gray-100);
        }
        .tab-button.active {
            color: var(--primary-600);
            border-bottom-color: var(--primary-600);
            background: white;
        }
        .type-selection-card {
            padding: 2rem 1.5rem;
            background: white;
            border: 2px solid var(--gray-200);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .type-selection-card:hover {
            border-color: var(--primary-600);
            background: var(--primary-50);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
    </style>
</head>
<body>
    <div class="filament-app">
        <aside class="filament-sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">üì¶</span>
                    <span class="logo-text">Adam Jaya</span>
                </div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-group">
                    <a href="../../index.html" class="nav-item">
                        <span class="nav-icon">üìä</span>
                        <span class="nav-label">Dashboard</span>
                    </a>
                </div>
                
                <div class="nav-group">
                    <div class="nav-group-label">üíº Penjualan</div>
                    <a href="customers.html" class="nav-item">
                        <span class="nav-icon">üë•</span>
                        <span class="nav-label">Customers</span>
                    </a>
                </div>
                
                <div class="nav-group">
                    <div class="nav-group-label">üõí Pembelian</div>
                    <a href="stocks.html" class="nav-item active">
                        <span class="nav-icon">üì¶</span>
                        <span class="nav-label">Master Barang/Stock</span>
                        <span class="nav-badge badge-danger">2</span>
                    </a>
                    <a href="suppliers.html" class="nav-item">
                        <span class="nav-icon">üè≠</span>
                        <span class="nav-label">Suppliers</span>
                    </a>
                    <a href="purchase-orders.html" class="nav-item">
                        <span class="nav-icon">üõçÔ∏è</span>
                        <span class="nav-label">Pembelian Barang (PO)</span>
                    </a>
                </div>
                
                <!-- <div class="nav-group">
                    <div class="nav-group-label">üì¶ Master Data</div>
                    <a href="roles.html" class="nav-item">
                        <span class="nav-icon">üîê</span>
                        <span class="nav-label">Roles</span>
                    </a>
                    <a href="users.html" class="nav-item">
                        <span class="nav-icon">üë•</span>
                        <span class="nav-label">Users</span>
                    </a>
                </div> -->
            </nav>
        </aside>

        <main class="filament-main">
            <header class="topbar">
                <div class="topbar-left">
                    <button class="sidebar-toggle" onclick="toggleSidebar()" title="Toggle Sidebar">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
                        </svg>
                    </button>
                    <div class="breadcrumb">
                        <a href="../../index.html" class="breadcrumb-item">Dashboard</a>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item">Pembelian</span>
                        <span class="breadcrumb-separator">/</span>
                        <span class="breadcrumb-item">Master Barang/Stock</span>
                    </div>
                </div>
                <div class="topbar-right">
                    <div class="user-menu">
                        <button class="user-avatar">SA</button>
                        <div class="user-dropdown">
                            <div class="user-info">
                                <div class="user-name">Super Admin</div>
                                <span class="badge badge-warning">Administrator</span>
                            </div>
                            <div class="user-menu-items">
                                <a href="#" class="user-menu-item">Profile</a>
                                <a href="#" class="user-menu-item">Settings</a>
                                <a href="#" class="user-menu-item">Logout</a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <div class="page-content">
                <!-- Stats -->
                <div class="stats-grid-4" style="margin-bottom: 1.5rem;">
                    <div class="stat-widget">
                        <div class="stat-header">
                            <span class="stat-label">Total Stock</span>
                            <span class="stat-icon">üì¶</span>
                        </div>
                        <div class="stat-value" id="totalStocks">0</div>
                        <div class="stat-footer">
                            <span class="stat-description">Total items</span>
                        </div>
                    </div>
                    <div class="stat-widget success">
                        <div class="stat-header">
                            <span class="stat-label">Local Products</span>
                            <span class="stat-icon">üè†</span>
                        </div>
                        <div class="stat-value" id="localStocks">0</div>
                        <div class="stat-footer">
                            <span class="stat-description">Produk lokal</span>
                        </div>
                    </div>
                    <div class="stat-widget">
                        <div class="stat-header">
                            <span class="stat-label">Import Products</span>
                            <span class="stat-icon">üåè</span>
                        </div>
                        <div class="stat-value" id="importStocks">0</div>
                        <div class="stat-footer">
                            <span class="stat-description">Produk import</span>
                        </div>
                    </div>
                    <div class="stat-widget alert">
                        <div class="stat-header">
                            <span class="stat-label">Low Stock</span>
                            <span class="stat-icon">‚ö†Ô∏è</span>
                        </div>
                        <div class="stat-value text-danger" id="lowStocks">0</div>
                        <div class="stat-footer">
                            <span class="stat-description">Needs restock</span>
                        </div>
                    </div>
                </div>

                <!-- Table -->
                <div class="widget-card">
                    <div class="card-header">
                        <h3 class="card-title">Daftar Master Barang/Stock</h3>
                        <button class="btn-primary" onclick="showTypeSelectionModal()">
                            <span>‚ûï</span>
                            <span>Tambah Barang</span>
                        </button>
                    </div>

                    <!-- Tabs -->
                    <div style="padding: 1rem 1.25rem; border-bottom: 1px solid var(--gray-200); background: var(--gray-50);">
                        <div style="display: flex; gap: 0.5rem; border-bottom: 2px solid var(--gray-200);">
                            <button class="tab-button active" data-tab="all" onclick="switchTab('all')">
                                <span>üìã</span>
                                <span>Semua Barang</span>
                            </button>
                            <button class="tab-button" data-tab="Local" onclick="switchTab('Local')">
                                <span>üè†</span>
                                <span>Barang Lokal</span>
                            </button>
                            <button class="tab-button" data-tab="Import" onclick="switchTab('Import')">
                                <span>üåè</span>
                                <span>Barang Import</span>
                            </button>
                        </div>
                    </div>

                    <div class="toolbar" style="padding: 1rem 1.25rem; border-bottom: 1px solid var(--gray-200);">
                        <div class="toolbar-left">
                            <div class="search-box">
                                <span class="search-icon">üîç</span>
                                <input type="text" class="search-input" placeholder="Cari barang..." id="searchInput">
                            </div>
                        </div>
                        <div class="toolbar-right">
                            <span id="filterInfo" style="color: var(--gray-600); font-size: 0.875rem;">Menampilkan: <strong>Semua Tipe</strong></span>
                        </div>
                    </div>

                    <div class="card-body no-padding">
                        <table class="filament-table">
                            <thead>
                                <tr>
                                    <th>Kode</th>
                                    <th>Nama Barang</th>
                                    <th>Tipe</th>
                                    <th>Satuan</th>
                                    <th>Stok Tersedia</th>
                                    <th>Min. Stock</th>
                                    <th>Harga Dasar</th>
                                    <th>Status</th>
                                    <th class="text-right">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="stocksTableBody"></tbody>
                        </table>
                    </div>

                    <div class="pagination" style="padding: 1rem 1.25rem;">
                        <div class="pagination-info">Menampilkan <strong id="displayCount">0</strong> dari <strong id="totalCount">0</strong> entri</div>
                        <div class="pagination-buttons">
                            <button class="pagination-button" disabled>‚Äπ Sebelumnya</button>
                            <button class="pagination-button active">1</button>
                            <button class="pagination-button" disabled>Selanjutnya ‚Ä∫</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Detail Modal -->
    <div class="modal-overlay" id="detailModal" style="display: none;">
        <div class="modal" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title" id="detailModalTitle">Detail Barang</h3>
                <button class="modal-close" onclick="closeDetailModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Kode Barang</label>
                        <input type="text" class="form-input" id="detailProductCode" readonly style="background-color: var(--gray-100);">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Jenis Barang</label>
                        <input type="text" class="form-input" id="detailProductType" readonly style="background-color: var(--gray-100);">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Nama Barang</label>
                    <input type="text" class="form-input" id="detailProductName" readonly style="background-color: var(--gray-100);">
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Satuan</label>
                        <input type="text" class="form-input" id="detailUnit" readonly style="background-color: var(--gray-100);">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Kategori</label>
                        <input type="text" class="form-input" id="detailCategory" readonly style="background-color: var(--gray-100);">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Jumlah Stok</label>
                        <input type="text" class="form-input" id="detailQuantity" readonly style="background-color: var(--gray-100);">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Stok Tersedia</label>
                        <input type="text" class="form-input" id="detailAvailable" readonly style="background-color: var(--gray-100);">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Minimum Stok</label>
                        <input type="text" class="form-input" id="detailMinStock" readonly style="background-color: var(--gray-100);">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Harga Dasar</label>
                        <input type="text" class="form-input" id="detailBasePrice" readonly style="background-color: var(--gray-100);">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Lokasi Penyimpanan</label>
                    <input type="text" class="form-input" id="detailLocation" readonly style="background-color: var(--gray-100);">
                </div>

                <div class="form-group">
                    <label class="form-label">Catatan</label>
                    <textarea class="form-textarea" id="detailNotes" readonly style="min-height: 80px; background-color: var(--gray-100);"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label">Status Stock</label>
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span id="detailStatus" class="badge">Normal</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeDetailModal()">Tutup</button>
                <button class="btn-primary" onclick="editFromDetail()">
                    <span>‚úèÔ∏è</span>
                    <span>Edit Barang</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Type Selection Modal -->
    <div class="modal-overlay" id="typeSelectionModal" style="display: none;">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Pilih Jenis Barang</h3>
                <button class="modal-close" onclick="closeTypeSelectionModal()">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1.5rem; color: var(--gray-600);">Pilih jenis barang yang akan Anda tambahkan:</p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <button class="type-selection-card" onclick="selectTypeAndCreate('Local')">
                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üè†</div>
                        <div style="font-weight: 600; margin-bottom: 0.25rem;">Barang Lokal</div>
                        <div style="font-size: 0.875rem; color: var(--gray-600);">Produk dalam negeri</div>
                    </button>
                    <button class="type-selection-card" onclick="selectTypeAndCreate('Import')">
                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üåè</div>
                        <div style="font-weight: 600; margin-bottom: 0.25rem;">Barang Import</div>
                        <div style="font-size: 0.875rem; color: var(--gray-600);">Produk luar negeri</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Form Modal -->
    <div class="modal-overlay" id="modalOverlay" style="display: none;">
        <div class="modal" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Tambah Barang</h3>
                <button class="modal-close" onclick="closeModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="stockForm">
                    <input type="hidden" id="stockId">
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label required">Kode Barang</label>
                            <input type="text" class="form-input" id="productCode" placeholder="BRG001" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Jenis Barang</label>
                            <select class="form-select" id="productType" required disabled style="background-color: var(--gray-100);">
                                <option value="">Pilih Jenis</option>
                                <option value="Local">Local</option>
                                <option value="Import">Import</option>
                            </select>
                            <p class="form-helper" id="typeHelper" style="margin-top: 0.5rem; color: var(--success-600); font-size: 0.875rem;"></p>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Nama Barang</label>
                        <input type="text" class="form-input" id="productName" placeholder="Nama lengkap barang" required>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label required">Satuan</label>
                            <select class="form-select" id="unit" required>
                                <option value="">Pilih Satuan</option>
                                <option value="pcs">Pcs</option>
                                <option value="box">Box</option>
                                <option value="karton">Karton</option>
                                <option value="kg">Kg</option>
                                <option value="liter">Liter</option>
                                <option value="meter">Meter</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Kategori</label>
                            <input type="text" class="form-input" id="category" placeholder="Elektronik, Furniture, dll">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label required">Harga Dasar</label>
                            <input type="number" class="form-input" id="basePrice" placeholder="0" min="0" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Batch Number</label>
                            <input type="text" class="form-input" id="batchNumber" placeholder="BATCH-001">
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label required">Jumlah Stok</label>
                            <input type="number" class="form-input" id="quantity" placeholder="0" min="0" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label required">Minimum Stok</label>
                            <input type="number" class="form-input" id="minimumStock" placeholder="0" min="0" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Lokasi Penyimpanan</label>
                        <input type="text" class="form-input" id="location" placeholder="Gudang A - Rak 1">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Catatan</label>
                        <textarea class="form-textarea" id="notes" rows="3" placeholder="Catatan tambahan..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal()">Batal</button>
                <button class="btn-primary" onclick="saveStock()">
                    <span>üíæ</span>
                    <span>Simpan</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'all';
        let selectedType = null;
        let stocks = [
            { id: 1, product_code: 'BRG001', product_name: 'Laptop ASUS ROG', product_type: 'Import', unit: 'pcs', category: 'Elektronik', base_price: 15000000, quantity: 50, available_quantity: 45, minimum_stock: 10, location: 'Gudang A', notes: 'Premium gaming laptop' },
            { id: 2, product_code: 'BRG002', product_name: 'Mouse Wireless Logitech', product_type: 'Import', unit: 'pcs', category: 'Aksesoris', base_price: 250000, quantity: 8, available_quantity: 5, minimum_stock: 20, location: 'Gudang B', notes: 'Low stock - reorder' },
            { id: 3, product_code: 'BRG003', product_name: 'Kursi Gaming DXRacer', product_type: 'Local', unit: 'pcs', category: 'Furniture', base_price: 3500000, quantity: 25, available_quantity: 25, minimum_stock: 5, location: 'Gudang C', notes: '' },
            { id: 4, product_code: 'BRG004', product_name: 'Meja Kantor Minimalis', product_type: 'Local', unit: 'pcs', category: 'Furniture', base_price: 1500000, quantity: 30, available_quantity: 28, minimum_stock: 10, location: 'Gudang C', notes: 'Kayu jati premium' }
        ];

        function renderTable() {
            const tbody = document.getElementById('stocksTableBody');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            let filtered = stocks;
            if (currentTab !== 'all') {
                filtered = stocks.filter(s => s.product_type === currentTab);
            }
            
            if (searchTerm) {
                filtered = filtered.filter(s => 
                    s.product_code.toLowerCase().includes(searchTerm) ||
                    s.product_name.toLowerCase().includes(searchTerm) ||
                    (s.category && s.category.toLowerCase().includes(searchTerm))
                );
            }
            
            document.getElementById('displayCount').textContent = filtered.length;
            document.getElementById('totalCount').textContent = stocks.length;
            
            tbody.innerHTML = filtered.map(stock => {
                const isLowStock = stock.available_quantity < stock.minimum_stock;
                return `
                <tr>
                    <td><strong>${stock.product_code}</strong></td>
                    <td><strong>${stock.product_name}</strong></td>
                    <td>
                        <span class="badge ${stock.product_type === 'Import' ? 'info' : 'gray'}">
                            ${stock.product_type === 'Import' ? 'üåè Import' : 'üè† Local'}
                        </span>
                    </td>
                    <td>${stock.unit}</td>
                    <td>${stock.available_quantity}</td>
                    <td>${stock.minimum_stock}</td>
                    <td>Rp ${stock.base_price.toLocaleString()}</td>
                    <td>
                        ${isLowStock ? 
                            '<span class="badge badge-warning">‚ö†Ô∏è Low Stock</span>' : 
                            '<span class="badge success">‚úì Normal</span>'}
                    </td>
                    <td class="text-right">
                        <div class="table-actions" style="justify-content: flex-end;">
                            <button class="btn-icon" onclick="viewStock(${stock.id})" title="View">üëÅÔ∏è</button>
                            <button class="btn-icon" onclick="editStock(${stock.id})" title="Edit">‚úèÔ∏è</button>
                            <button class="btn-icon danger" onclick="deleteStock(${stock.id})" title="Delete">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `}).join('');
        }

        function updateStats() {
            document.getElementById('totalStocks').textContent = stocks.length;
            document.getElementById('localStocks').textContent = stocks.filter(s => s.product_type === 'Local').length;
            document.getElementById('importStocks').textContent = stocks.filter(s => s.product_type === 'Import').length;
            document.getElementById('lowStocks').textContent = stocks.filter(s => s.available_quantity < s.minimum_stock).length;
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tab) btn.classList.add('active');
            });
            
            const filterInfo = document.getElementById('filterInfo');
            if (tab === 'all') filterInfo.innerHTML = 'Menampilkan: <strong>Semua Tipe</strong>';
            else if (tab === 'Local') filterInfo.innerHTML = 'Menampilkan: <strong>üè† Barang Lokal</strong>';
            else if (tab === 'Import') filterInfo.innerHTML = 'Menampilkan: <strong>üåè Barang Import</strong>';
            
            renderTable();
        }

        function showTypeSelectionModal() {
            document.getElementById('typeSelectionModal').style.display = 'flex';
            setTimeout(() => document.getElementById('typeSelectionModal').classList.add('show'), 10);
        }

        function closeTypeSelectionModal() {
            document.getElementById('typeSelectionModal').classList.remove('show');
            setTimeout(() => document.getElementById('typeSelectionModal').style.display = 'none', 200);
        }

        function selectTypeAndCreate(type) {
            selectedType = type;
            closeTypeSelectionModal();
            setTimeout(() => showCreateModal(), 300);
        }

        function showCreateModal() {
            document.getElementById('modalTitle').textContent = 'Tambah Barang';
            document.getElementById('stockForm').reset();
            document.getElementById('stockId').value = '';
            
            if (selectedType) {
                document.getElementById('productType').value = selectedType;
                document.getElementById('productType').disabled = true;
                
                const helper = document.getElementById('typeHelper');
                if (selectedType === 'Local') {
                    helper.innerHTML = '‚úÖ Barang LOKAL dipilih';
                    helper.style.color = 'var(--success-600)';
                } else if (selectedType === 'Import') {
                    helper.innerHTML = 'üìò Barang IMPORT dipilih';
                    helper.style.color = 'var(--primary-600)';
                }
            }
            
            document.getElementById('modalOverlay').style.display = 'flex';
            setTimeout(() => document.getElementById('modalOverlay').classList.add('show'), 10);
        }

        function editStock(id) {
            const stock = stocks.find(s => s.id === id);
            if (!stock) return;

            selectedType = stock.product_type;
            document.getElementById('modalTitle').textContent = 'Edit Barang';
            document.getElementById('stockId').value = stock.id;
            document.getElementById('productCode').value = stock.product_code;
            document.getElementById('productName').value = stock.product_name;
            document.getElementById('productType').value = stock.product_type;
            document.getElementById('productType').disabled = true;
            document.getElementById('unit').value = stock.unit;
            document.getElementById('category').value = stock.category || '';
            document.getElementById('basePrice').value = stock.base_price;
            document.getElementById('batchNumber').value = stock.batch_number || '';
            document.getElementById('quantity').value = stock.quantity;
            document.getElementById('minimumStock').value = stock.minimum_stock;
            document.getElementById('location').value = stock.location || '';
            document.getElementById('notes').value = stock.notes || '';
            
            const helper = document.getElementById('typeHelper');
            if (stock.product_type === 'Local') {
                helper.innerHTML = '‚úÖ Barang LOKAL';
                helper.style.color = 'var(--success-600)';
            } else {
                helper.innerHTML = 'üìò Barang IMPORT';
                helper.style.color = 'var(--primary-600)';
            }
            
            document.getElementById('modalOverlay').style.display = 'flex';
            setTimeout(() => document.getElementById('modalOverlay').classList.add('show'), 10);
        }

        function viewStock(id) {
            const stock = stocks.find(s => s.id === id);
            if (!stock) return;

            document.getElementById('detailModalTitle').textContent = `Detail Barang - ${stock.product_name}`;
            document.getElementById('detailProductCode').value = stock.product_code;
            document.getElementById('detailProductType').value = stock.product_type === 'Local' ? 'üè† Barang Lokal' : 'üåè Barang Import';
            document.getElementById('detailProductName').value = stock.product_name;
            document.getElementById('detailUnit').value = stock.unit;
            document.getElementById('detailCategory').value = stock.category || '-';
            document.getElementById('detailQuantity').value = stock.quantity;
            document.getElementById('detailAvailable').value = stock.available_quantity;
            document.getElementById('detailMinStock').value = stock.minimum_stock;
            document.getElementById('detailBasePrice').value = 'Rp ' + stock.base_price.toLocaleString();
            document.getElementById('detailLocation').value = stock.location || '-';
            document.getElementById('detailNotes').value = stock.notes || '-';
            
            const statusElement = document.getElementById('detailStatus');
            const isLowStock = stock.available_quantity < stock.minimum_stock;
            if (isLowStock) {
                statusElement.className = 'badge badge-warning';
                statusElement.innerHTML = '‚ö†Ô∏è Low Stock';
            } else {
                statusElement.className = 'badge success';
                statusElement.innerHTML = '‚úì Normal';
            }
            
            document.getElementById('detailModal').dataset.stockId = stock.id;
            document.getElementById('detailModal').style.display = 'flex';
            setTimeout(() => document.getElementById('detailModal').classList.add('show'), 10);
        }

        function deleteStock(id) {
            if (confirm('Apakah Anda yakin ingin menghapus barang ini?')) {
                const index = stocks.findIndex(s => s.id === id);
                if (index !== -1) {
                    stocks.splice(index, 1);
                    renderTable();
                    updateStats();
                    alert('Barang berhasil dihapus!');
                }
            }
        }

        function closeModal() {
            selectedType = null;
            document.getElementById('modalOverlay').classList.remove('show');
            setTimeout(() => document.getElementById('modalOverlay').style.display = 'none', 200);
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.remove('show');
            setTimeout(() => document.getElementById('detailModal').style.display = 'none', 200);
        }

        function editFromDetail() {
            const stockId = document.getElementById('detailModal').dataset.stockId;
            closeDetailModal();
            setTimeout(() => editStock(parseInt(stockId)), 300);
        }

        function saveStock() {
            const id = document.getElementById('stockId').value;
            const product_code = document.getElementById('productCode').value;
            const product_name = document.getElementById('productName').value;
            const product_type = document.getElementById('productType').value;
            const unit = document.getElementById('unit').value;

            if (!product_code || !product_name || !product_type || !unit) {
                alert('Data wajib harus diisi!');
                return;
            }

            const stockData = {
                product_code,
                product_name,
                product_type,
                unit,
                category: document.getElementById('category').value,
                base_price: parseInt(document.getElementById('basePrice').value) || 0,
                batch_number: document.getElementById('batchNumber').value,
                quantity: parseInt(document.getElementById('quantity').value) || 0,
                available_quantity: parseInt(document.getElementById('quantity').value) || 0,
                minimum_stock: parseInt(document.getElementById('minimumStock').value) || 0,
                location: document.getElementById('location').value,
                notes: document.getElementById('notes').value
            };

            if (id) {
                const stock = stocks.find(s => s.id === parseInt(id));
                if (stock) {
                    stockData.available_quantity = stock.available_quantity + (stockData.quantity - stock.quantity);
                    Object.assign(stock, stockData);
                }
                alert('Barang berhasil diupdate!');
            } else {
                stockData.id = Math.max(...stocks.map(s => s.id), 0) + 1;
                stocks.push(stockData);
                alert('Barang berhasil ditambahkan!');
            }

            closeModal();
            renderTable();
            updateStats();
        }

        document.getElementById('searchInput').addEventListener('input', renderTable);
        
        document.addEventListener('DOMContentLoaded', function() {
            updateStats();
            renderTable();
        });
        
        document.getElementById('typeSelectionModal').addEventListener('click', function(e) {
            if (e.target === this) closeTypeSelectionModal();
        });
        document.getElementById('modalOverlay').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });
        document.getElementById('detailModal').addEventListener('click', function(e) {
            if (e.target === this) closeDetailModal();
        });
    </script>
    <script src="../../assets/js/filament-dashboard.js"></script>
</body>
</html>
